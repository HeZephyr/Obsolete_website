<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>锁定数据结构 | Pursuit&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="随便写写">
    <meta name="keywords" content="python,Go,C++,git,github,markdown,database,mysql,redis">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a3990aec.css" as="style"><link rel="preload" href="/assets/js/app.650f29ba.js" as="script"><link rel="preload" href="/assets/js/4.71a85121.js" as="script"><link rel="preload" href="/assets/js/1.4a1189e9.js" as="script"><link rel="preload" href="/assets/js/3.bca043f9.js" as="script"><link rel="preload" href="/assets/js/123.ef35a55d.js" as="script"><link rel="preload" href="/assets/js/20.bc1029fc.js" as="script"><link rel="prefetch" href="/assets/js/10.ce2d8b4d.js"><link rel="prefetch" href="/assets/js/100.c6b7de61.js"><link rel="prefetch" href="/assets/js/101.6a0674e2.js"><link rel="prefetch" href="/assets/js/102.c48f5daa.js"><link rel="prefetch" href="/assets/js/103.78ac82ac.js"><link rel="prefetch" href="/assets/js/104.ce74ea62.js"><link rel="prefetch" href="/assets/js/105.59019f8c.js"><link rel="prefetch" href="/assets/js/106.a6484004.js"><link rel="prefetch" href="/assets/js/107.26f8c339.js"><link rel="prefetch" href="/assets/js/108.19c4918a.js"><link rel="prefetch" href="/assets/js/109.ad3f0ac6.js"><link rel="prefetch" href="/assets/js/11.87208a0c.js"><link rel="prefetch" href="/assets/js/110.d37ebc18.js"><link rel="prefetch" href="/assets/js/111.19621c04.js"><link rel="prefetch" href="/assets/js/112.7d0536a5.js"><link rel="prefetch" href="/assets/js/113.cd1bae80.js"><link rel="prefetch" href="/assets/js/114.a280068c.js"><link rel="prefetch" href="/assets/js/115.54086579.js"><link rel="prefetch" href="/assets/js/116.1653dc84.js"><link rel="prefetch" href="/assets/js/117.5c10682f.js"><link rel="prefetch" href="/assets/js/118.6ba27329.js"><link rel="prefetch" href="/assets/js/119.ed8b3335.js"><link rel="prefetch" href="/assets/js/12.7f5cceef.js"><link rel="prefetch" href="/assets/js/120.3e80ed2d.js"><link rel="prefetch" href="/assets/js/121.b267969a.js"><link rel="prefetch" href="/assets/js/122.bb07546a.js"><link rel="prefetch" href="/assets/js/124.a774bcf0.js"><link rel="prefetch" href="/assets/js/125.f4bca6e8.js"><link rel="prefetch" href="/assets/js/126.19b4e53e.js"><link rel="prefetch" href="/assets/js/127.178a0262.js"><link rel="prefetch" href="/assets/js/128.564f1abe.js"><link rel="prefetch" href="/assets/js/129.874a2845.js"><link rel="prefetch" href="/assets/js/13.f2cea533.js"><link rel="prefetch" href="/assets/js/130.5799dc2f.js"><link rel="prefetch" href="/assets/js/131.c49ddb75.js"><link rel="prefetch" href="/assets/js/132.7bf5bc01.js"><link rel="prefetch" href="/assets/js/133.d2177b93.js"><link rel="prefetch" href="/assets/js/134.0b353dca.js"><link rel="prefetch" href="/assets/js/135.8c5ad821.js"><link rel="prefetch" href="/assets/js/136.044f50ab.js"><link rel="prefetch" href="/assets/js/137.e651d8a1.js"><link rel="prefetch" href="/assets/js/138.c34ee399.js"><link rel="prefetch" href="/assets/js/139.d2c2c523.js"><link rel="prefetch" href="/assets/js/14.f8459573.js"><link rel="prefetch" href="/assets/js/140.c9649214.js"><link rel="prefetch" href="/assets/js/141.74d180b1.js"><link rel="prefetch" href="/assets/js/142.d0f49248.js"><link rel="prefetch" href="/assets/js/143.c0da862a.js"><link rel="prefetch" href="/assets/js/144.02aba23a.js"><link rel="prefetch" href="/assets/js/145.0a6a9b17.js"><link rel="prefetch" href="/assets/js/146.8abb935f.js"><link rel="prefetch" href="/assets/js/147.4a1f7a7b.js"><link rel="prefetch" href="/assets/js/148.a323943b.js"><link rel="prefetch" href="/assets/js/149.229e12dd.js"><link rel="prefetch" href="/assets/js/15.06cd6cc8.js"><link rel="prefetch" href="/assets/js/150.5b86d585.js"><link rel="prefetch" href="/assets/js/151.8f55fefa.js"><link rel="prefetch" href="/assets/js/152.f7cb0a56.js"><link rel="prefetch" href="/assets/js/153.a4c6cafe.js"><link rel="prefetch" href="/assets/js/154.9ee7f2f7.js"><link rel="prefetch" href="/assets/js/155.054ec7e7.js"><link rel="prefetch" href="/assets/js/156.41526dc0.js"><link rel="prefetch" href="/assets/js/157.34bd81b3.js"><link rel="prefetch" href="/assets/js/158.dacd8f46.js"><link rel="prefetch" href="/assets/js/159.a31a4175.js"><link rel="prefetch" href="/assets/js/16.33942615.js"><link rel="prefetch" href="/assets/js/160.67a29219.js"><link rel="prefetch" href="/assets/js/161.2e18152c.js"><link rel="prefetch" href="/assets/js/162.85afc95c.js"><link rel="prefetch" href="/assets/js/163.0f3d6ce9.js"><link rel="prefetch" href="/assets/js/164.611b0d20.js"><link rel="prefetch" href="/assets/js/165.566e69ea.js"><link rel="prefetch" href="/assets/js/166.8cf31ac3.js"><link rel="prefetch" href="/assets/js/167.a43496c3.js"><link rel="prefetch" href="/assets/js/168.ebc4fe62.js"><link rel="prefetch" href="/assets/js/169.6993fea0.js"><link rel="prefetch" href="/assets/js/17.da2e0126.js"><link rel="prefetch" href="/assets/js/170.bdf40293.js"><link rel="prefetch" href="/assets/js/171.8e293d78.js"><link rel="prefetch" href="/assets/js/172.795c8c5f.js"><link rel="prefetch" href="/assets/js/173.a2629458.js"><link rel="prefetch" href="/assets/js/174.26889005.js"><link rel="prefetch" href="/assets/js/175.63bb1654.js"><link rel="prefetch" href="/assets/js/176.8bd31b1a.js"><link rel="prefetch" href="/assets/js/177.b221f1cc.js"><link rel="prefetch" href="/assets/js/178.df5ab45f.js"><link rel="prefetch" href="/assets/js/179.672adc07.js"><link rel="prefetch" href="/assets/js/18.a39b8ae2.js"><link rel="prefetch" href="/assets/js/180.b9892398.js"><link rel="prefetch" href="/assets/js/181.46c0a89a.js"><link rel="prefetch" href="/assets/js/182.49becce8.js"><link rel="prefetch" href="/assets/js/19.1760f287.js"><link rel="prefetch" href="/assets/js/2.8e76b5b7.js"><link rel="prefetch" href="/assets/js/21.4b161474.js"><link rel="prefetch" href="/assets/js/22.69d29451.js"><link rel="prefetch" href="/assets/js/23.2a87052f.js"><link rel="prefetch" href="/assets/js/24.6beeaf9b.js"><link rel="prefetch" href="/assets/js/25.e9d4e312.js"><link rel="prefetch" href="/assets/js/26.c128f1d5.js"><link rel="prefetch" href="/assets/js/27.2bab9253.js"><link rel="prefetch" href="/assets/js/28.0b0ea581.js"><link rel="prefetch" href="/assets/js/29.71a2a1e9.js"><link rel="prefetch" href="/assets/js/30.11fd1987.js"><link rel="prefetch" href="/assets/js/31.92abb231.js"><link rel="prefetch" href="/assets/js/32.27d7c672.js"><link rel="prefetch" href="/assets/js/33.9f002fe8.js"><link rel="prefetch" href="/assets/js/34.39abd7b3.js"><link rel="prefetch" href="/assets/js/35.a54492ae.js"><link rel="prefetch" href="/assets/js/36.1b3ef370.js"><link rel="prefetch" href="/assets/js/37.3dda47b6.js"><link rel="prefetch" href="/assets/js/38.3dc3656a.js"><link rel="prefetch" href="/assets/js/39.78160c0e.js"><link rel="prefetch" href="/assets/js/40.382841f8.js"><link rel="prefetch" href="/assets/js/41.885f2f51.js"><link rel="prefetch" href="/assets/js/42.a794deca.js"><link rel="prefetch" href="/assets/js/43.bd06b1c5.js"><link rel="prefetch" href="/assets/js/44.c5b9fce0.js"><link rel="prefetch" href="/assets/js/45.8e169e05.js"><link rel="prefetch" href="/assets/js/46.fbbc9d0e.js"><link rel="prefetch" href="/assets/js/47.12a977cd.js"><link rel="prefetch" href="/assets/js/48.7c4206ed.js"><link rel="prefetch" href="/assets/js/49.16bab940.js"><link rel="prefetch" href="/assets/js/5.780a742d.js"><link rel="prefetch" href="/assets/js/50.bf2afa43.js"><link rel="prefetch" href="/assets/js/51.0a1e84c2.js"><link rel="prefetch" href="/assets/js/52.59a39ef7.js"><link rel="prefetch" href="/assets/js/53.572697e9.js"><link rel="prefetch" href="/assets/js/54.fc2487d6.js"><link rel="prefetch" href="/assets/js/55.3db8ca64.js"><link rel="prefetch" href="/assets/js/56.da82f3ee.js"><link rel="prefetch" href="/assets/js/57.65140fab.js"><link rel="prefetch" href="/assets/js/58.4f519804.js"><link rel="prefetch" href="/assets/js/59.8d7b46a7.js"><link rel="prefetch" href="/assets/js/6.6c206683.js"><link rel="prefetch" href="/assets/js/60.51f050d8.js"><link rel="prefetch" href="/assets/js/61.6abcae6d.js"><link rel="prefetch" href="/assets/js/62.7a4cb712.js"><link rel="prefetch" href="/assets/js/63.d178adeb.js"><link rel="prefetch" href="/assets/js/64.1de53088.js"><link rel="prefetch" href="/assets/js/65.1f66b952.js"><link rel="prefetch" href="/assets/js/66.3d9ec4f6.js"><link rel="prefetch" href="/assets/js/67.c25c7eea.js"><link rel="prefetch" href="/assets/js/68.c2233d35.js"><link rel="prefetch" href="/assets/js/69.b5a9f3d3.js"><link rel="prefetch" href="/assets/js/7.03420b55.js"><link rel="prefetch" href="/assets/js/70.6c554f9a.js"><link rel="prefetch" href="/assets/js/71.4d711ab3.js"><link rel="prefetch" href="/assets/js/72.ea2a2f74.js"><link rel="prefetch" href="/assets/js/73.4082041c.js"><link rel="prefetch" href="/assets/js/74.ebb8af9b.js"><link rel="prefetch" href="/assets/js/75.97fb55e0.js"><link rel="prefetch" href="/assets/js/76.285801a4.js"><link rel="prefetch" href="/assets/js/77.a26a0c17.js"><link rel="prefetch" href="/assets/js/78.9ef506e7.js"><link rel="prefetch" href="/assets/js/79.1de1acb4.js"><link rel="prefetch" href="/assets/js/80.6b49a79a.js"><link rel="prefetch" href="/assets/js/81.a4b9d26e.js"><link rel="prefetch" href="/assets/js/82.1079fef2.js"><link rel="prefetch" href="/assets/js/83.cfaa864c.js"><link rel="prefetch" href="/assets/js/84.8e869aa2.js"><link rel="prefetch" href="/assets/js/85.ea42d8a3.js"><link rel="prefetch" href="/assets/js/86.a948fda8.js"><link rel="prefetch" href="/assets/js/87.ec5eefd3.js"><link rel="prefetch" href="/assets/js/88.a3c0617a.js"><link rel="prefetch" href="/assets/js/89.674cd71f.js"><link rel="prefetch" href="/assets/js/90.e21849d0.js"><link rel="prefetch" href="/assets/js/91.840a99e2.js"><link rel="prefetch" href="/assets/js/92.71d5cf4a.js"><link rel="prefetch" href="/assets/js/93.82f797c2.js"><link rel="prefetch" href="/assets/js/94.86f8a135.js"><link rel="prefetch" href="/assets/js/95.2cd56f02.js"><link rel="prefetch" href="/assets/js/96.1318b23d.js"><link rel="prefetch" href="/assets/js/97.387efb30.js"><link rel="prefetch" href="/assets/js/98.7c6ea3db.js"><link rel="prefetch" href="/assets/js/99.95666a77.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.caeb3b49.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a3990aec.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="Pursuit's blog" class="logo"> <span class="site-name can-hide">Pursuit's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/develop/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/develop/language/" class="nav-link">编程语言</a></li><li class="dropdown-item"><!----> <a href="/develop/framework/" class="nav-link">开发框架</a></li><li class="dropdown-item"><!----> <a href="/develop/algorithm/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/develop/storage/" class="nav-link">数据存储</a></li><li class="dropdown-item"><!----> <a href="/develop/system/" class="nav-link">系统架构</a></li><li class="dropdown-item"><!----> <a href="/develop/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/develop/cloud/" class="nav-link">云原生</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/vcs/" class="nav-link">版本控制</a></li><li class="dropdown-item"><!----> <a href="/tool/network/" class="nav-link">网络工具</a></li><li class="dropdown-item"><!----> <a href="/tool/develop/" class="nav-link">开发工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><a href="/note/" class="link-title">学习笔记</a> <span class="title" style="display:none;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/paper/" class="nav-link">学术搬砖</a></li><li class="dropdown-item"><!----> <a href="/note/project/" class="nav-link">实践项目</a></li><li class="dropdown-item"><!----> <a href="/note/lecture/" class="nav-link">讲座研讨</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活杂谈" class="dropdown-title"><a href="/life/" class="link-title">生活杂谈</a> <span class="title" style="display:none;">生活杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/year/" class="nav-link">随写编年</a></li><li class="dropdown-item"><!----> <a href="/life/youth/" class="nav-link">追忆青春</a></li><li class="dropdown-item"><!----> <a href="/life/travel/" class="nav-link">旅行日记</a></li><li class="dropdown-item"><!----> <a href="/life/art/" class="nav-link">文艺时光</a></li><li class="dropdown-item"><!----> <a href="/life/cook/" class="nav-link">烹调分享</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源收藏" class="dropdown-title"><a href="/resource/" class="link-title">资源收藏</a> <span class="title" style="display:none;">资源收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/resource/website/" class="nav-link">实用网站</a></li><li class="dropdown-item"><!----> <a href="/resource/project/" class="nav-link">优秀项目</a></li><li class="dropdown-item"><!----> <a href="/resource/study/" class="nav-link">学习资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/interview/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/more/tip/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/more/blog/" class="nav-link">博客相关</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friend/" class="nav-link">友链</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/unique-pure/my-vdoing-blog-template" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>Pursuit</h3> <span>但行好事，莫问前程</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/develop/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/develop/language/" class="nav-link">编程语言</a></li><li class="dropdown-item"><!----> <a href="/develop/framework/" class="nav-link">开发框架</a></li><li class="dropdown-item"><!----> <a href="/develop/algorithm/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/develop/storage/" class="nav-link">数据存储</a></li><li class="dropdown-item"><!----> <a href="/develop/system/" class="nav-link">系统架构</a></li><li class="dropdown-item"><!----> <a href="/develop/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/develop/cloud/" class="nav-link">云原生</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/vcs/" class="nav-link">版本控制</a></li><li class="dropdown-item"><!----> <a href="/tool/network/" class="nav-link">网络工具</a></li><li class="dropdown-item"><!----> <a href="/tool/develop/" class="nav-link">开发工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><a href="/note/" class="link-title">学习笔记</a> <span class="title" style="display:none;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/paper/" class="nav-link">学术搬砖</a></li><li class="dropdown-item"><!----> <a href="/note/project/" class="nav-link">实践项目</a></li><li class="dropdown-item"><!----> <a href="/note/lecture/" class="nav-link">讲座研讨</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活杂谈" class="dropdown-title"><a href="/life/" class="link-title">生活杂谈</a> <span class="title" style="display:none;">生活杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/year/" class="nav-link">随写编年</a></li><li class="dropdown-item"><!----> <a href="/life/youth/" class="nav-link">追忆青春</a></li><li class="dropdown-item"><!----> <a href="/life/travel/" class="nav-link">旅行日记</a></li><li class="dropdown-item"><!----> <a href="/life/art/" class="nav-link">文艺时光</a></li><li class="dropdown-item"><!----> <a href="/life/cook/" class="nav-link">烹调分享</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源收藏" class="dropdown-title"><a href="/resource/" class="link-title">资源收藏</a> <span class="title" style="display:none;">资源收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/resource/website/" class="nav-link">实用网站</a></li><li class="dropdown-item"><!----> <a href="/resource/project/" class="nav-link">优秀项目</a></li><li class="dropdown-item"><!----> <a href="/resource/study/" class="nav-link">学习资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/interview/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/more/tip/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/more/blog/" class="nav-link">博客相关</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friend/" class="nav-link">友链</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/unique-pure/my-vdoing-blog-template" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据存储</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>系统架构</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>操作系统</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/77a74b/" class="sidebar-link">进程介绍</a></li><li><a href="/pages/1d4493/" class="sidebar-link">进程API</a></li><li><a href="/pages/4b8a3a/" class="sidebar-link">有限直接执行</a></li><li><a href="/pages/f0c724/" class="sidebar-link">CPU调度</a></li><li><a href="/pages/a1ad96/" class="sidebar-link">多级反馈队列</a></li><li><a href="/pages/40a229/" class="sidebar-link">比例份额调度</a></li><li><a href="/pages/326999/" class="sidebar-link">多CPU调度</a></li><li><a href="/pages/23b20c/" class="sidebar-link">地址空间</a></li><li><a href="/pages/174348/" class="sidebar-link">内存API</a></li><li><a href="/pages/542fcd/" class="sidebar-link">地址转换</a></li><li><a href="/pages/506cee/" class="sidebar-link">段</a></li><li><a href="/pages/d34e64/" class="sidebar-link">空闲空间管理</a></li><li><a href="/pages/69f0fb/" class="sidebar-link">页</a></li><li><a href="/pages/fe36b0/" class="sidebar-link">快表</a></li><li><a href="/pages/165f2d/" class="sidebar-link">高级页表</a></li><li><a href="/pages/65f57a/" class="sidebar-link">页面交换</a></li><li><a href="/pages/aeb7cb/" class="sidebar-link">交换策略</a></li><li><a href="/pages/9f0f28/" class="sidebar-link">完整VM系统</a></li><li><a href="/pages/1ef559/" class="sidebar-link">并发和线程</a></li><li><a href="/pages/2994ff/" class="sidebar-link">线程API</a></li><li><a href="/pages/fe4f25/" class="sidebar-link">锁</a></li><li><a href="/pages/396fa2/" aria-current="page" class="active sidebar-link">锁定数据结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/396fa2/#_1-并发计数器" class="sidebar-link">1 并发计数器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/396fa2/#_1-1-简单但不可扩展" class="sidebar-link">1.1 简单但不可扩展</a></li><li class="sidebar-sub-header level3"><a href="/pages/396fa2/#_1-2-可扩展计数器" class="sidebar-link">1.2 可扩展计数器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/396fa2/#_2-并发链表" class="sidebar-link">2 并发链表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/396fa2/#_2-1-基本实现" class="sidebar-link">2.1 基本实现</a></li><li class="sidebar-sub-header level3"><a href="/pages/396fa2/#_2-2-扩展链表" class="sidebar-link">2.2 扩展链表</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/396fa2/#_3-并发队列" class="sidebar-link">3 并发队列</a></li><li class="sidebar-sub-header level2"><a href="/pages/396fa2/#_4-并发哈希表" class="sidebar-link">4 并发哈希表</a></li></ul></li><li><a href="/pages/463259/" class="sidebar-link">条件变量</a></li><li><a href="/pages/adf4ea/" class="sidebar-link">信号量</a></li><li><a href="/pages/a9671b/" class="sidebar-link">并发bug</a></li><li><a href="/pages/19d9ef/" class="sidebar-link">基于事件的并发</a></li><li><a href="/pages/628c92/" class="sidebar-link">IO设备</a></li><li><a href="/pages/8d5e59/" class="sidebar-link">硬盘驱动器</a></li><li><a href="/pages/04dd86/" class="sidebar-link">廉价磁盘冗余阵列</a></li><li><a href="/pages/1539cb/" class="sidebar-link">文件和目录</a></li><li><a href="/pages/a2ee8a/" class="sidebar-link">文件系统实现</a></li><li><a href="/pages/61d032/" class="sidebar-link">快速文件系统</a></li><li><a href="/pages/d2b72b/" class="sidebar-link">FSCK和日志</a></li><li><a href="/pages/abc8b5/" class="sidebar-link">日志结构文件系统</a></li><li><a href="/pages/b0802a/" class="sidebar-link">基于闪存的SSD</a></li><li><a href="/pages/812baf/" class="sidebar-link">数据完整性和保护</a></li><li><a href="/pages/5fb229/" class="sidebar-link">分布式系统</a></li><li><a href="/pages/627a30/" class="sidebar-link">网络文件系统</a></li><li><a href="/pages/acfea7/" class="sidebar-link">Andrew文件系统</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>分布式系统</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>云原生</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/develop/#开发" data-v-06225672>开发</a></li><li data-v-06225672><a href="/develop/#系统架构" data-v-06225672>系统架构</a></li><li data-v-06225672><a href="/develop/#操作系统" data-v-06225672>操作系统</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/unique-pure" target="_blank" title="作者" class="beLink" data-v-06225672>Pursuit</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-05-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">锁定数据结构<!----></h1>  <div class="theme-vdoing-content content__default"><p>在讨论锁之前，我们首先描述如何在一些常见的数据结构中使用锁。向数据结构添加锁以使其可由线程使用，从而使该结构成为<font color="red">线程安全</font>的。如何加锁决定了数据结构的正确性和性能。因此，我们面临着关键挑战：当给定一个特定的数据结构时，我们应该如何向它添加锁，以使其正常工作？此外，我们如何添加锁以使数据结构产生高性能，使许多线程能够同时（即并发）访问该结构？</p> <h2 id="_1-并发计数器"><a href="#_1-并发计数器" class="header-anchor">#</a> 1 并发计数器</h2> <p>计数器是最简单的数据结构之一。它是一种常用的结构，具有简单的接口。下面代码中中定义了一个简单的非并发计数器。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__counter_t</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">counter_t</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token operator">-&gt;</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token operator">-&gt;</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token operator">-&gt;</span>value<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> c<span class="token operator">-&gt;</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_1-1-简单但不可扩展"><a href="#_1-1-简单但不可扩展" class="header-anchor">#</a> 1.1 简单但不可扩展</h3> <p>正如您所看到的，非并发计数器是一个简单的数据结构，需要少量的代码来实现。现在我们面临下一个挑战：如何使这段代码线程安全？下面这段代码显示了我们如何做到这一点。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__counter_t</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> value<span class="token punctuation">;</span>
    <span class="token class-name">pthread_mutex_t</span> lock<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">counter_t</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token operator">-&gt;</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token operator">-&gt;</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token operator">-&gt;</span>value<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> rc <span class="token operator">=</span> c<span class="token operator">-&gt;</span>value<span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> rc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>这个并发计数器很简单并且工作正常。事实上，它遵循最简单和最基本的并发数据结构常见的设计模式：它只是添加一个锁，该锁在调用操作数据结构的例程时获取，并在从调用返回时释放。通过这种方式，它类似于使用监视器构建的数据结构，当您调用对象方法并从对象方法返回时，会自动获取和释放锁。</p> <p>至此，你已经有了一个可以运行的并发数据结构。你可能会遇到的问题是性能。如果你的数据结构速度太慢，你需要做的就不仅仅是添加一个锁了；因此，如果需要进行此类优化，这将是本章其余部分的主题。需要注意的是，如果数据结构的运行速度不是太慢，那么你就大功告成了！如果简单的数据结构也能正常工作，那么就没必要做什么花哨的事情了。</p> <p>为了了解简单方法的性能代价，我们运行了一个基准，其中每个线程更新单个共享计数器的次数是固定的；然后我们改变线程的数量。如下图所示，显示了在一到四个线程活动的情况下所花费的总时间；每个线程更新计数器 100 万次。本实验在配备四颗英特尔 2.7 GHz i5 CPU 的 iMac 上运行；如果激活的 CPU 越多，我们希望单位时间内完成的总工作量就越大。</p> <p><img src="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/Performance-Of-Traditional-vs-Approximate-Counters.png" alt="image-20240408143721333"></p> <p>从图中最上面一行（标注为 &quot;Precise&quot;）可以看出，并发计数器的性能扩展性很差。单个线程可以在极短的时间内（大约 0.03 秒）完成百万次计数器更新，而让两个线程同时更新计数器 100 万次则会导致速度大幅下降（超过 5 秒！）。线程越多，情况越糟糕。</p> <p>理想情况下，线程在多处理器上完成的速度要和单线程在单处理器上完成的速度一样快。实现这一目标被称为<strong>完美扩展</strong>；即使要完成更多工作，也是并行完成的，因此完成任务所需的时间不会增加。</p> <h3 id="_1-2-可扩展计数器"><a href="#_1-2-可扩展计数器" class="header-anchor">#</a> 1.2 可扩展计数器</h3> <p>令人惊讶的是，研究人员多年来一直在研究如何构建更具可扩展性的计数器。更令人惊叹的是，可扩展计数器的重要性，正如最近在操作系统性能分析方面的工作所显示的那样；如果没有可扩展计数，在 Linux 上运行的一些工作负载在多核机器上就会出现严重的可扩展性问题。</p> <p>为了解决这个问题，人们开发了许多技术。我们将介绍一种称为<strong>近似计数器</strong>的方法 [C06]。</p> <p>近似计数器的工作原理是通过众多本地物理计数器（每个 CPU 内核一个）和一个全局计数器来表示一个逻辑计数器。具体来说，在一台有四个 CPU 的机器上，有四个本地计数器和一个全局计数器。除了这些计数器外，还有锁：每个本地计数器和全局计数器各有一个锁。</p> <p>近似计数器的基本思想如下。当运行在给定内核上的线程希望递增计数器时，它会递增其本地计数器；通过相应的本地锁同步访问该本地计数器。由于每个 CPU 都有自己的本地计数器，因此跨 CPU 的线程可以无竞争地更新本地计数器，因此计数器的更新是可扩展的。</p> <p>不过，为了保持全局计数器的最新状态（以防线程希望读取其值），本地计数器的值会定期转移到全局计数器上，方法是获取全局锁，并根据本地计数器的值递增；然后将本地计数器重置为零。</p> <p>这种从本地到全局的转移发生频率由阈值 S 确定。S 越小，计数器的行为就越像上述不可扩展的计数器；S 越大，计数器的可扩展性就越强，但全局值可能会偏离实际计数。我们可以简单地获取所有本地锁和全局锁（按指定顺序，以避免死锁）来获得精确值，但这是不可扩展的。</p> <p>为了说明这一点，我们来看一个例子，如下图所示。</p> <p><img src="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/Tracing-The-Approximate-Counters.png" alt="image-20240408150033961"></p> <p>在这个例子中，阈值 S 设置为 5，四个 CPU 上都有线程在更新本地计数器 L1 ... L4。全局计数器值 (G) 也显示在跟踪中，随着时间的推移不断向下增加。在每个时间步长，本地计数器都可能递增；如果本地值达到阈值 S，本地值就会转移到全局计数器，然后本地计数器被重置。</p> <p>在上图中（标注为 &quot;Approximate&quot;）的下线显示了阈值 S 为 1024 的近似计数器的性能。该计数器的性能非常出色；在四个处理器上更新计数器 400 万次所需的时间几乎不超过在一个处理器上更新计数器 100 万次所需的时间。</p> <p>下图显示了阈值 S 的重要性，四个线程在四个 CPU 上各递增计数器 100 万次。如果 S 值较低，则性能较差（但全局计数总是相当准确）；如果 S 值较高，则性能出色，但全局计数滞后（最多滞后 CPU 数量乘以 S）。近似计数器正是通过这种精度/性能权衡实现的。</p> <p><img src="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/image-20240408150613853.png" alt="image-20240408150613853"></p> <p>近似计数器的粗略版本如下面这段代码所示。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__counter_t</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> global<span class="token punctuation">;</span> <span class="token comment">// global count</span>
    <span class="token class-name">pthread_mutex_t</span> glock<span class="token punctuation">;</span> <span class="token comment">// global lock</span>
    <span class="token keyword">int</span> local<span class="token punctuation">[</span>NUMCPUS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// local count (per cpu)</span>
    <span class="token class-name">pthread_mutex_t</span> llock<span class="token punctuation">[</span>NUMCPUS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ... and locks</span>
    <span class="token keyword">int</span> threshold<span class="token punctuation">;</span> <span class="token comment">// update frequency</span>
<span class="token punctuation">}</span> <span class="token class-name">counter_t</span><span class="token punctuation">;</span>

<span class="token comment">// init: record threshold, init locks, init values</span>
<span class="token comment">// of all local counts and global count</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">,</span> <span class="token keyword">int</span> threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token operator">-&gt;</span>threshold <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    c<span class="token operator">-&gt;</span>global <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>glock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUMCPUS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        c<span class="token operator">-&gt;</span>local<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>llock<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// update: usually, just grab local lock and update local amount</span>
<span class="token comment">// once local count has risen by ’threshold’, grab global</span>
<span class="token comment">// lock and transfer local values to it</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">,</span> <span class="token keyword">int</span> threadID<span class="token punctuation">,</span> <span class="token keyword">int</span> amt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> cpu <span class="token operator">=</span> threadID <span class="token operator">%</span> NUMCPUS<span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>llock<span class="token punctuation">[</span>cpu<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token operator">-&gt;</span>local<span class="token punctuation">[</span>cpu<span class="token punctuation">]</span> <span class="token operator">+=</span> amt<span class="token punctuation">;</span> <span class="token comment">// assumes amt &gt; 0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token operator">-&gt;</span>local<span class="token punctuation">[</span>cpu<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> c<span class="token operator">-&gt;</span>threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// transfer to global</span>
        <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>glock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token operator">-&gt;</span>global <span class="token operator">+=</span> c<span class="token operator">-&gt;</span>local<span class="token punctuation">[</span>cpu<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>glock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token operator">-&gt;</span>local<span class="token punctuation">[</span>cpu<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>llock<span class="token punctuation">[</span>cpu<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// get: just return global amount (which may not be perfect)</span>
<span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">counter_t</span> <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>glock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> val <span class="token operator">=</span> c<span class="token operator">-&gt;</span>global<span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token operator">-&gt;</span>glock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> val<span class="token punctuation">;</span> <span class="token comment">// only approximate!</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="_2-并发链表"><a href="#_2-并发链表" class="header-anchor">#</a> 2 并发链表</h2> <h3 id="_2-1-基本实现"><a href="#_2-1-基本实现" class="header-anchor">#</a> 2.1 基本实现</h3> <p>接下来，我们要研究一种更复杂的结构—链表。让我们再次从基本方法开始。为了简单起见，我们将省略这种列表中的一些显而易见的例程，而只关注并发插入；至于查找、删除等，我们将留给读者自己去思考或者可以在仓库中找到更详细的版本。下面显示了这种初级数据结构的代码。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// basic node structure</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__node_t</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> key<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">__node_t</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">node_t</span><span class="token punctuation">;</span>

<span class="token comment">// basic list structure (one used per list)</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__list_t</span> <span class="token punctuation">{</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>head<span class="token punctuation">;</span>
    <span class="token class-name">pthread_mutex_t</span> lock<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">list_t</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">List_Init</span><span class="token punctuation">(</span><span class="token class-name">list_t</span> <span class="token operator">*</span>L<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    L<span class="token operator">-&gt;</span>head <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>L<span class="token operator">-&gt;</span>lock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">List_Insert</span><span class="token punctuation">(</span><span class="token class-name">list_t</span> <span class="token operator">*</span>L<span class="token punctuation">,</span> <span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> thread_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>L<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Thread %d: Inserting %d\n&quot;</span><span class="token punctuation">,</span> thread_id<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>new <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">node_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>new <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;malloc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>L<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// fail</span>
    <span class="token punctuation">}</span>
    new<span class="token operator">-&gt;</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
    new<span class="token operator">-&gt;</span>next <span class="token operator">=</span> L<span class="token operator">-&gt;</span>head<span class="token punctuation">;</span>
    L<span class="token operator">-&gt;</span>head <span class="token operator">=</span> new<span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>L<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// success</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>从代码中可以看出，代码只是在进入插入例程时获取一个锁，并在退出时释放它。如果 <code>malloc()</code> 恰好失败（这种情况很少见），就会出现一个棘手的小问题；在这种情况下，代码还必须在插入失败前释放锁。</p> <p>事实证明，这种特殊的控制流非常容易出错；最近对 Linux 内核补丁的一项研究发现，很大一部分错误（近 40%）都是在这种很少使用的代码路径上发现的。因此，我们面临着一个挑战：我们能否重写插入和查找例程，使其在并发插入时保持正确，但避免失败路径也需要我们添加<code>unlock</code>调用的情况？</p> <p>在这种情况下，答案是肯定的。具体来说，我们可以重构一下<code>List_Insert</code>代码，使锁定和释放只围绕插入代码中的实际临界区，并在删除代码中使用共同的退出路径。前者之所以有效，是因为部分查找代码实际上无需锁定；假设 <code>malloc()</code> 和<code>printf</code>本身是线程安全的，那么每个线程都可以调用它，而不必担心出现竞争条件或其他并发错误。只有在更新共享列表时才需要加锁。有关这些修改的详细信息，请见下面这段代码。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// basic node structure
typedef struct __node_t {
    int key;
    struct __node_t *next;
} node_t;

// basic list structure (one used per list)
typedef struct __list_t {
    node_t *head;
    pthread_mutex_t lock;
} list_t;

void List_Init(list_t *L) {
    L-&gt;head = NULL;
    pthread_mutex_init(&amp;L-&gt;lock, NULL);
}

int List_Insert(list_t *L, int key, int thread_id) {
    printf(&quot;Thread %d: Inserting %d\n&quot;, thread_id, key);
    node_t *new = malloc(sizeof(node_t));
    if (new == NULL) {
        perror(&quot;malloc&quot;);
        pthread_mutex_unlock(&amp;L-&gt;lock);
        return -1; // fail
    }
    new-&gt;key = key;
    pthread_mutex_lock(&amp;L-&gt;lock);
    new-&gt;next = L-&gt;head;
    L-&gt;head = new;
    pthread_mutex_unlock(&amp;L-&gt;lock);
    return 0; // success
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_2-2-扩展链表"><a href="#_2-2-扩展链表" class="header-anchor">#</a> 2.2 扩展链表</h3> <p>虽然我们又有了一个基本的并发链表，但我们又一次遇到了它不能很好扩展的情况。为了在链表中实现更多并发性，研究人员探索了一种技术，即所谓的 &quot;手拉手锁定&quot;（又称 &quot;锁耦合&quot;）。</p> <p>这个想法非常简单。你可以为链表的每个节点添加一个锁，而不是为整个链表添加一个锁。当遍历列表时，代码会先抓取下一个节点的锁，然后释放当前节点的锁（这就是 <code>hand-over-hand</code> 名称的由来）。</p> <p>从概念上讲，&quot;交手 &quot;链表是有一定道理的；它可以实现高度并发的操作。然而，在实践中，这种结构很难比简单的单锁方法更快，因为为遍历链表的每个节点获取和释放锁的开销太大。即使是非常大的链表和大量的线程，允许多个正在进行的遍历所带来的并发性也不可能比简单地获取单锁、执行操作和释放锁更快。也许某种混合方式（每隔几个节点就抓取一个新锁）值得研究。</p> <blockquote><center>TIP：并发越多不一定越快</center> <p>如果您设计的方案增加了很多开销（例如，频繁获取和释放锁，而不是一次性），那么它更具并发性可能就不重要了。简单的方案往往效果良好，特别是如果它们很少使用昂贵的例程。增加更多锁和复杂性可能会导致失败。尽管如此，有一种真正需要了解的方法：构建两种替代方案（<font color="red">简单但并发性较低、复杂但并发性较高</font>）并测量它们的表现。最终，您无法在性能上作弊；您的想法要么更快，要么不是。</p> <center>警惕锁和控制流
</center> <p>一个通用的设计提示，在并发代码以及其他地方都很有用，就是要警惕导致函数返回、退出或其他类似错误条件从而停止函数执行的控制流变化。因为许多函数会首先获取锁、分配一些内存或进行其他类似的有状态操作，<font color="red">当出现错误时，代码必须在返回之前撤销所有状态，这样容易出错。</font>因此，最好结构化代码以最小化这种模式。</p></blockquote> <h2 id="_3-并发队列"><a href="#_3-并发队列" class="header-anchor">#</a> 3 并发队列</h2> <p>正如您现在所知，制作并发数据结构总是有一个标准方法：添加一个大锁。对于队列，我们将跳过该方法，假设您可以弄清楚。</p> <p>相反，我们将看一下由 Michael 和 Scott 设计的并发程度稍高的队列。代码如下所示。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__node_t</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> value<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">__node_t</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">node_t</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__queue_t</span> <span class="token punctuation">{</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>head<span class="token punctuation">;</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
    <span class="token class-name">pthread_mutex_t</span> headLock<span class="token punctuation">;</span> <span class="token comment">// Mutex for head pointer</span>
    <span class="token class-name">pthread_mutex_t</span> tailLock<span class="token punctuation">;</span> <span class="token comment">// Mutex for tail pointer</span>
<span class="token punctuation">}</span> <span class="token class-name">queue_t</span><span class="token punctuation">;</span>

<span class="token comment">// Initialize the queue</span>
<span class="token keyword">void</span> <span class="token function">Queue_Init</span><span class="token punctuation">(</span><span class="token class-name">queue_t</span> <span class="token operator">*</span>q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Allocate memory for a dummy node to represent the head of the queue</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>tmp <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">node_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token comment">// Initialize the head and tail pointers to the dummy node</span>
    q<span class="token operator">-&gt;</span>head <span class="token operator">=</span> q<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token comment">// Initialize mutexes for head and tail pointers</span>
    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>headLock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>tailLock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Enqueue an element into the queue</span>
<span class="token keyword">void</span> <span class="token function">Queue_Enqueue</span><span class="token punctuation">(</span><span class="token class-name">queue_t</span> <span class="token operator">*</span>q<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Allocate memory for the new node</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>tmp <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">node_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>tmp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tmp<span class="token operator">-&gt;</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token comment">// Acquire the tailLock mutex</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>tailLock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Insert the new node after the current tail node</span>
    q<span class="token operator">-&gt;</span>tail<span class="token operator">-&gt;</span>next <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token comment">// Update the tail pointer to point to the new node</span>
    q<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token comment">// Release the tailLock mutex</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>tailLock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Dequeue an element from the queue</span>
<span class="token keyword">int</span> <span class="token function">Queue_Dequeue</span><span class="token punctuation">(</span><span class="token class-name">queue_t</span> <span class="token operator">*</span>q<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Acquire the headLock mutex</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>headLock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get the current head node</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>tmp <span class="token operator">=</span> q<span class="token operator">-&gt;</span>head<span class="token punctuation">;</span>
    <span class="token comment">// Get the next node after the head</span>
    <span class="token class-name">node_t</span> <span class="token operator">*</span>newHead <span class="token operator">=</span> tmp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token comment">// If the queue is empty (newHead is NULL), release the headLock mutex and return -1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newHead <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>headLock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// queue was empty</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Extract the value from the node to be dequeued</span>
    <span class="token operator">*</span>value <span class="token operator">=</span> newHead<span class="token operator">-&gt;</span>value<span class="token punctuation">;</span>
    <span class="token comment">// Update the head pointer to point to the next node</span>
    q<span class="token operator">-&gt;</span>head <span class="token operator">=</span> newHead<span class="token punctuation">;</span>
    <span class="token comment">// Release the headLock mutex</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>headLock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Free the memory of the dequeued node</span>
    <span class="token function">free</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Return 0 indicating successful dequeue operation</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>如果你仔细研究这段代码，你会发现有两个锁，一个用于队列的头部，一个用于队列的尾部。这两个锁的目标是实现入队和出队操作的并发。在常见情况下，入队例程将仅访问尾部锁，而出队只会访问头部锁。</p> <p>Michael 和 Scott 使用的一个技巧是添加一个虚拟节点（在队列初始化代码中分配）；这个虚拟节点可以实现头尾操作的分离。</p> <p>队列通常用在多线程应用程序中。然而，这里使用的队列类型（仅带有锁）通常不能完全满足此类程序的需求。一个更充分开发的有界队列，使线程能够在队列为空或过满时等待，这是条件变量可以做到的事情。</p> <h2 id="_4-并发哈希表"><a href="#_4-并发哈希表" class="header-anchor">#</a> 4 并发哈希表</h2> <p>最后，我们将讨论一种简单而又广泛适用的并发数据结构—哈希表。我们将重点讨论一个不调整大小的简单哈希表，代码如下所示；处理调整大小需要做更多的工作，我们将其作为一个练习留给读者（抱歉！）。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUCKETS</span> <span class="token expression"><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__hash_t</span> <span class="token punctuation">{</span>
    <span class="token class-name">list_t</span> lists<span class="token punctuation">[</span>BUCKETS<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">hash_t</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">Hash_Init</span><span class="token punctuation">(</span><span class="token class-name">hash_t</span> <span class="token operator">*</span>H<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUCKETS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">List_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>H<span class="token operator">-&gt;</span>lists<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">Hash_Insert</span><span class="token punctuation">(</span><span class="token class-name">hash_t</span> <span class="token operator">*</span>H<span class="token punctuation">,</span> <span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> thread_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> bucket <span class="token operator">=</span> key <span class="token operator">%</span> BUCKETS<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">List_Insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>H<span class="token operator">-&gt;</span>lists<span class="token punctuation">[</span>bucket<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> thread_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">Hash_Remove</span><span class="token punctuation">(</span><span class="token class-name">hash_t</span> <span class="token operator">*</span>H<span class="token punctuation">,</span> <span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> thread_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> bucket <span class="token operator">=</span> key <span class="token operator">%</span> BUCKETS<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">List_Remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>H<span class="token operator">-&gt;</span>lists<span class="token punctuation">[</span>bucket<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> thread_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>这个并发哈希表非常简单，使用我们之前开发的并发链表构建，而且运行得非常好。它之所以性能出色，是因为它没有为整个结构设置一个锁，而是为每个哈希桶（每个哈希桶由一个链表表示）设置了一个锁。这样就可以进行许多并发操作。</p> <p>下图 显示了哈希表在并发更新下的性能（在同一台配备四个 CPU 的 iMac 电脑上，四个线程的并发更新次数从 10,000 次到 50,000 次不等）。为便于比较，图中还显示了链表的性能（使用单锁）。从图中可以看出，这个简单的并发哈希表的扩展能力很强，而链表则不然。</p> <p><img src="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/Scaling-Hash-Tables.png" alt="image-20240408230513598"></p> <blockquote><center>避免过早优化（KNUTH定律）</center> <p>在构建并发数据结构时，应从最基本的方法开始，即添加一个大锁以提供同步访问。这样做，你就有可能构建一个正确的锁；如果你发现它存在性能问题，你可以对它进行改进，从而在必要时使它变得更快。正如 Knuth 的名言：&quot;过早优化是万恶之源&quot;。</p> <p>在向多处理器过渡之初，许多操作系统都使用单锁，包括 Sun OS 和 Linux。在后者中，这种锁甚至有一个名字，即<font color="red">大内核锁（BKL</font>）。多年来，这种简单的方法一直很好，但当多 CPU 系统成为常态时，内核中每次只允许一个活动线程就成了性能瓶颈。因此，终于到了为这些系统添加改进并发性优化的时候了。在 Linux 系统中，采用了更直接的方法：用多个锁代替一个锁。而在 Sun 内部，则做出了一个更激进的决定：建立一个全新的操作系统，即 Solaris，从一开始就从根本上融入并发性。</p></blockquote></div></div> <div class="page-slot page-slot-bottom"><div class="donation">
      <button>打赏</button>
      <div class="main">
        <div class="pic">
          <img src="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/wechatpay.jpeg" alt="微信">
          <img src="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/zhifubaopay.jpeg" alt="支付宝">
        </div>
      </div>  
    </div></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=OS" title="标签">#OS</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/05/11, 20:58:35</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/fe4f25/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">锁</div></a> <a href="/pages/463259/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">条件变量</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/fe4f25/" class="prev">锁</a></span> <span class="next"><a href="/pages/463259/">条件变量</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/6eacac/"><div>
            数据结构与算法 面试题目总结
            <!----></div></a> <span class="date">06-01</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/c513f0/"><div>
            C/C++ 面试题目总结
            <!----></div></a> <span class="date">06-01</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/336152/"><div>
            【MIT 6.5840(6.824)学习笔记】GFS
            <!----></div></a> <span class="date">05-28</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:unique.hzf@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/unique-pure" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://pursuit.blog.csdn.net/" title="My CSDN" target="_blank" class="iconfont icon-csdn"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2024
    <span>Pursuit | <a href="https://github.com/unique-pure/my-vdoing-blog-template/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><div></div><WebInfo></WebInfo><PageInfo></PageInfo><div></div></div></div>
    <script src="/assets/js/app.650f29ba.js" defer></script><script src="/assets/js/4.71a85121.js" defer></script><script src="/assets/js/1.4a1189e9.js" defer></script><script src="/assets/js/3.bca043f9.js" defer></script><script src="/assets/js/123.ef35a55d.js" defer></script><script src="/assets/js/20.bc1029fc.js" defer></script>
  </body>
</html>
