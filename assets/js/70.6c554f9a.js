(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{427:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/2509679/how-to-generate-a-random-integer-number-from-within-a-range",target:"_blank",rel:"noopener noreferrer"}},[s._v("出处"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("如何使用C语言生成随机数？例如希望生成一段特定范围的随机数，如"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mo",{attrs:{stretchy:"false"}},[s._v("[")]),a("mn",[s._v("1")]),a("mo",{attrs:{separator:"true"}},[s._v(",")]),a("mn",[s._v("6")]),a("mo",{attrs:{stretchy:"false"}},[s._v("]")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("[1,6]")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),a("span",{staticClass:"mopen"},[s._v("[")]),a("span",{staticClass:"mord"},[s._v("1")]),a("span",{staticClass:"mpunct"},[s._v(",")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.1667em"}}),a("span",{staticClass:"mord"},[s._v("6")]),a("span",{staticClass:"mclose"},[s._v("]")])])])]),s._v("来模拟掷骰子。")]),s._v(" "),a("blockquote",[a("p",[s._v("到目前为止，所有答案在数学上都是错误的。返回 "),a("code",[s._v("rand() % N")]),s._v(" 并不统一给出 "),a("code",[s._v("[0, N)")]),s._v(" 范围内的数字，除非 "),a("code",[s._v("N")]),s._v(" 除以 "),a("code",[s._v("rand()")]),s._v(" 返回的区间长度（即是 2 的幂）。此外，我们不知道 "),a("code",[s._v("rand()")]),s._v(" 的模数是否独立：它们有可能是 "),a("code",[s._v("0, 1, 2, ...")]),s._v(" ，这是均匀的但不是很随机。唯一似乎合理的假设是 "),a("code",[s._v("rand()")]),s._v(" 给出泊松分布：任何两个相同大小的非重叠子区间均可能且独立。对于一组有限的值，这意味着均匀分布，并且还确保 "),a("code",[s._v("rand()")]),s._v(" 的值很好地分散。")]),s._v(" "),a("p",[s._v("这意味着更改 "),a("code",[s._v("rand()")]),s._v(" 范围的唯一正确方法是将其分为多个框；例如，如果 "),a("code",[s._v("RAND_MAX == 11")]),s._v(" 并且您想要 "),a("code",[s._v("1..6")]),s._v(" 的范围，则应将 "),a("code",[s._v("{0,1}")]),s._v(" 分配给 1，将 "),a("code",[s._v("{2,3}")]),s._v(" 分配给 2，依此类推在。这些是不相交的、大小相等的区间，因此是均匀且独立分布的。")]),s._v(" "),a("p",[s._v("使用浮点除法的建议在数学上是合理的，但原则上存在舍入问题。也许 "),a("code",[s._v("double")]),s._v(" 的精度足以使其工作；也许不是。我不知道，也不想弄清楚；无论如何，答案取决于系统。")]),s._v(" "),a("p",[s._v("正确的方法是使用整数运算。也就是说，您想要如下所示的内容：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdlib.h>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// For random(), RAND_MAX")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Assumes 0 <= max <= RAND_MAX")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Returns in the closed interval [0, max]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("random_at_most")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// max <= RAND_MAX < ULONG_MAX, so this is okay.")]),s._v("\n    num_bins "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    num_rand "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" RAND_MAX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    bin_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" num_rand "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" num_bins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    defect   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" num_rand "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" num_bins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// This is carefully written not to overflow")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num_rand "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" defect "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Truncated division is intentional")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("为了获得完全均匀的分布，循环是必要的。例如，如果给你 0 到 2 之间的随机数，而你只想要 0 到 1 之间的数字，你就继续拉，直到没有 2 为止；不难检查这是否以相同的概率给出 0 或 1。 这里使用 "),a("code",[s._v("random()")]),s._v(" 而不是 "),a("code",[s._v("rand()")]),s._v(" 因为它具有更好的分布（如 "),a("code",[s._v("rand()")]),s._v(" 的手册页所述）。")]),s._v(" "),a("p",[s._v("如果你想获得默认范围 "),a("code",[s._v("[0, RAND_MAX]")]),s._v(" 之外的随机值，那么你必须做一些棘手的事情。也许最方便的方法是定义一个函数 "),a("code",[s._v("random_extended()")]),s._v(" 提取 "),a("code",[s._v("n")]),s._v(" 位（使用 "),a("code",[s._v("random_at_most()")]),s._v(" ）并返回 "),a("code",[s._v("[0, 2**n)")]),s._v(" ，然后应用 "),a("code",[s._v("random_at_most()")]),s._v(" 用 "),a("code",[s._v("random_extended()")]),s._v(" 代替 "),a("code",[s._v("random()")]),s._v(" （并用 "),a("code",[s._v("2**n - 1")]),s._v(" 代替 "),a("code",[s._v("RAND_MAX")]),s._v(" ）来提取随机值小于 "),a("code",[s._v("2**n")]),s._v(" ，假设您有一个可以保存这样的值的数字类型。最后，当然，您可以使用 "),a("code",[s._v("min + random_at_most(max - min)")]),s._v(" 获取 "),a("code",[s._v("[min, max]")]),s._v(" 中的值，包括负值。")])]),s._v(" "),a("p",[s._v("这段代码通过以下方式确保生成的随机数在闭区间 [0, max] 内均匀分布：")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("确定随机数的范围和数量")]),s._v("：\n"),a("ul",[a("li",[a("code",[s._v("num_bins")]),s._v(" 表示生成的随机数的数量，即 "),a("code",[s._v("max")]),s._v(" 的值加一，因为随机数生成器的范围是左闭右开的。")]),s._v(" "),a("li",[a("code",[s._v("num_rand")]),s._v(" 表示随机数生成器的最大值加一，表示总的可能的随机数的数量。")])])]),s._v(" "),a("li",[a("strong",[s._v("计算每个区间的大小")]),s._v("：\n"),a("ul",[a("li",[a("code",[s._v("bin_size")]),s._v(" 表示每个区间的大小，即将随机数的总数量除以可能的随机数的数量，以确保每个随机数的概率相等。")])])]),s._v(" "),a("li",[a("strong",[s._v("处理不能均匀分配的情况")]),s._v("：\n"),a("ul",[a("li",[a("code",[s._v("defect")]),s._v(" 表示随机数总数量除以可能的随机数数量的余数，用于处理不能均匀分配的情况。")])])]),s._v(" "),a("li",[a("strong",[s._v("生成随机数并检查范围")]),s._v("：\n"),a("ul",[a("li",[s._v("使用 "),a("code",[s._v("do-while")]),s._v(" 循环来生成随机数，并检查生成的随机数是否在指定的范围内，如果不在范围内则重新生成，直到生成的随机数在指定范围内。")])])]),s._v(" "),a("li",[a("strong",[s._v("返回均匀分布的随机数")]),s._v("：\n"),a("ul",[a("li",[s._v("将生成的随机数除以区间大小得到的结果，即在闭区间 [0, max] 内均匀分布的随机数。")])])])]),s._v(" "),a("p",[s._v("通过以上步骤，代码确保了生成的随机数在指定范围内且分布均匀。")])])}),[],!1,null,null,null);a.default=e.exports}}]);